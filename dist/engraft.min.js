"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.html=html;exports.default=exports.innerHTML=void 0;function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++){n[t]=e[t]}return n}}function _typeof(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function e(t){return typeof t}}else{_typeof=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof(e)}var innerHTML=Symbol("innerHTML");exports.innerHTML=innerHTML;var _engraft="ðŸŽ‹";var Engraft={innerHTML:innerHTML,html:html};var isEmptyObject=function e(t){return Object.entries(t).length===0&&t.constructor===Object};function htmlEscape(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")}function hashCode(e){var t="",n="abcdefghijklmnopqrstuvwxyz".concat(e?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":"","0123456789");for(var r=0;r<15;r++){t+=n.charAt(Math.floor(Math.random()*n.length))}return t}function HTMLtoJSON(e,t){var n;if(typeof e==="string"){var r;if(window.DOMParser){var o=new DOMParser;r=o.parseFromString(e,"text/html")}if(t!=null&&t instanceof HTMLElement){var a=t.tagName,i=t.attributes,l=r.body,c=l.firstChild,f=l.textContent,u=r.body.children;n={tagName:a,attributes:i,textContent:f,firstChild:c.nodeType===3?c:document.createTextNode(""),children:u}}}else if(_typeof(e)==="object"){n=e}var s=function e(t){return{tagName:t.tagName,textValue:t.firstChild&&t.firstChild.nodeValue,textContent:t.textContent,attributes:Object.fromEntries(Array.from(t.attributes,function(e){var t=e.name,n=e.value;return[t,n]})),children:Array.from(t.children,e)}};return n&&s(n)}function html(e){var d=e.raw;var h="",v=[],y,m=function e(n){if(_typeof(n)==="object"){if(n===null||Object.getOwnPropertyNames(n).length===0)return;else if("_engraft"in n){n.elemEvents.length&&(v=[].concat(_toConsumableArray(v),_toConsumableArray(n.elemEvents)));return n.result}return Object.prototype.toString===n.toString?Object.keys(n).reduce(function(e,t){return e+"".concat(t,": ").concat(n[t],",\n          ")},"[Object toString] "):n}};for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}n.forEach(function(e,t){var n=d[t];var r=_typeof(e);if(e==null||r==="object"&&Object.getOwnPropertyNames(e).length===0){e=""}else{if(Array.isArray(e)){var o="";e.forEach(function(e){return o+=m(e)});e=o||e.join("")}else if(r==="object"){e=n.slice(-8).match(/\s+style=["']/)?Object.entries(e).map(function(e){return e.join(":")}).join(";"):m(e)}else if(r==="function"&&(y=n.slice(-15).match(/\son.*=["']$/))){var a=n.charAt(n.length-1);var i=a.charCodeAt();var l=y[0].slice(3,-2);var c="_engraft-id-"+hashCode();var f=hashCode(true);var u=String(e);if(e.name.startsWith("bound ")&&u.startsWith(r)&&u.includes("native code")){var s=i===34?"'":'"';u="".concat(s).concat(r," ").concat(e.name.substring(5)," ").concat(u.substring(9)).concat(s)}v.push({engraftID:c,engraftIDValue:f,eventHandler:e,eventType:l,handlerBody:u});e="".concat(u).concat(a," ").concat(c,"=").concat(a).concat(f)}}if(n.endsWith("!")){e=htmlEscape(e);n=n.slice(0,-1)}h+=n;h+=e});h+=d[d.length-1];return{result:h,elemEvents:v,_engraft:_engraft}}(function e(){_engraft in window||(window[_engraft]=!function(){var e;Object.defineProperties(HTMLElement.prototype,(e={},_defineProperty(e,innerHTML,{get:function e(){return this.innerHTML},set:function e(t){var i=this;var n=t.result,r=t.elemEvents;console.info("Element is in the DOM?: "+this.isConnected);if(this.isConnected&&!isEmptyObject(this.vdom)&&document.contains(this)){var o=HTMLtoJSON(n,this);var a=this.vdom;var l=function e(t,n){var r=function e(t,n,r){var o=Object.is(_typeof(t),"undefined"),a=Object.is(_typeof(n),"undefined");if(o&&a){console.log("nothing to change");return}var i=Object.assign({},t),l=Object.assign({},n);var c={newContent:"",oldContent:"",children:[],index:r};if(!o&&a){c.oldContent=i.textValue;c.newContent="";c.index=-1}else if(o&&!a){c.oldContent="";c.newContent=l.textValue;c.tagName=l.tagName;c.index=r+1}else{var f=i.textValue;var u=l.textValue;if(f!==u){c.newContent=u;c.oldContent=f}else{c.textContent=l.textContent}}var s=i.children||[];var d=l.children||[];var h=Math.max(s.length,d.length);if(h>0&&i.textContent!==l.textContent){for(var v=0;v<h;v++){var y=e(s[v],d[v],v);if(y.newContent||y.oldContent||i.textContent!==l.textContent&&y.children.length>0){c.children.push(y)}}}return c};var o=r(t,n,-1);var a=function e(t,n){var r=Object.is(_typeof(t),"undefined"),o=Object.is(_typeof(n),"undefined");if(r&&o){console.log("no diffs to apply");return}var a=t.children;if(a.length&&t.textContent!==n.textContent){var i=true;var l=false;var c=undefined;try{for(var f=a[Symbol.iterator](),u;!(i=(u=f.next()).done);i=true){var s=u.value;var d=n.children;var h=s.index<d.length?d[s.index]:n;e(s,h)}}catch(e){l=true;c=e}finally{try{if(!i&&f.return!=null){f.return()}}finally{if(l){throw c}}}}if(t.newContent){if(t.oldContent){n.firstChild.nodeValue=t.newContent;console.log("content updating")}else{var v=document.createElement(t.tagName);var y=document.createTextNode(t.newContent);v.appendChild(y);n.appendChild(v)}}else if(t.oldContent){n.remove()}};a(o,i)};l(a,o);this.vdom=o}else{this.innerHTML=n;this.vdom=HTMLtoJSON(n,this);console.log(this.vdom);var c=true;var f=false;var u=undefined;try{for(var s=r[Symbol.iterator](),d;!(c=(d=s.next()).done);c=true){var h=d.value;var v=h.engraftID,y=h.engraftIDValue,m=h.eventHandler,p=h.eventType,g=h.handlerBody;var b=this.querySelector("[".concat(v,'="').concat(y,'"]'));if(b!=null&&typeof m==="function"){if(!m.name&&g.startsWith("function")){debugger;console.error(g,"function expression must have a name");throw new TypeError("function expression must have a name")}b[p]&&b.addEventListener(p,m);b.removeAttribute(v)}}}catch(e){f=true;u=e}finally{try{if(!c&&s.return!=null){s.return()}}finally{if(f){throw u}}}}},enumerable:true,configurable:true}),_defineProperty(e,"vdom",{value:{},writable:true}),e))}())})();var _default=Engraft;exports.default=_default;