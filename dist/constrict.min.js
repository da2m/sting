"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.html=html;exports.default=exports.innerHTML=void 0;function _defineProperty(t,e,n){if(e in t){Object.defineProperty(t,e,{value:n,enumerable:true,configurable:true,writable:true})}else{t[e]=n}return t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++){n[e]=t[e]}return n}}function _typeof(t){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function t(e){return typeof e}}else{_typeof=function t(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(t)}var innerHTML=Symbol("innerHTML");exports.innerHTML=innerHTML;var _constrict="🗜️";var Constrict={innerHTML:innerHTML,html:html};var isEmptyObject=function t(e){return Object.entries(e).length===0&&e.constructor===Object};function htmlEscape(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")}function hashCode(t){var e="",n="abcdefghijklmnopqrstuvwxyz".concat(t?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":"","0123456789");for(var r=0;r<15;r++){e+=n.charAt(Math.floor(Math.random()*n.length))}return e}function HTMLtoJSON(t,e){var n;if(typeof t==="string"){var r;if(window.DOMParser){var o=new DOMParser;r=o.parseFromString(t,"text/html")}if(e!=null&&e instanceof HTMLElement){var a=e.tagName,i=e.attributes,c=r.body,l=c.firstChild,s=c.textContent,u=r.body.children;n={tagName:a,attributes:i,textContent:s,firstChild:l.nodeType===3?l:document.createTextNode(""),children:u}}}else if(_typeof(t)==="object"){n=t}var f=function t(e){return{tagName:e.tagName,textValue:e.firstChild&&e.firstChild.nodeValue,textContent:e.textContent,attributes:Object.fromEntries(Array.from(e.attributes,function(t){var e=t.name,n=t.value;return[e,n]})),children:Array.from(e.children,t)}};return n&&f(n)}function html(t){var d=t.raw;var h="",v=[],y,m=function t(n){if(_typeof(n)==="object"){if(n===null||Object.getOwnPropertyNames(n).length===0)return;else if("_constrict"in n){n.elemEvents.length&&(v=[].concat(_toConsumableArray(v),_toConsumableArray(n.elemEvents)));return n.result}return Object.prototype.toString===n.toString?Object.keys(n).reduce(function(t,e){return t+"".concat(e,": ").concat(n[e],",\n          ")},"[Object toString] "):n}};for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++){n[r-1]=arguments[r]}n.forEach(function(t,e){var n=d[e];var r=_typeof(t);if(t==null||r==="object"&&Object.getOwnPropertyNames(t).length===0){t=""}else{if(Array.isArray(t)){var o="";t.forEach(function(t){return o+=m(t)});t=o||t.join("")}else if(r==="object"){t=n.slice(-8).match(/\s+style=["']/)?Object.entries(t).map(function(t){return t.join(":")}).join(";"):m(t)}else if(r==="function"&&(y=n.slice(-15).match(/\son.*=["']$/))){var a=n.charAt(n.length-1);var i=a.charCodeAt();var c=y[0].slice(3,-2);var l="_constrict-id-"+hashCode();var s=hashCode(true);var u=String(t);if(t.name.startsWith("bound ")&&u.startsWith(r)&&u.includes("native code")){var f=i===34?"'":'"';u="".concat(f).concat(r," ").concat(t.name.substring(5)," ").concat(u.substring(9)).concat(f)}v.push({constrictID:l,constrictIDValue:s,eventHandler:t,eventType:c,handlerBody:u});t="".concat(u).concat(a," ").concat(l,"=").concat(a).concat(s)}}if(n.endsWith("!")){t=htmlEscape(t);n=n.slice(0,-1)}h+=n;h+=t});h+=d[d.length-1];return{result:h,elemEvents:v,_constrict:_constrict}}(function t(){_constrict in window||(window[_constrict]=!function(){var t;Object.defineProperties(HTMLElement.prototype,(t={},_defineProperty(t,innerHTML,{get:function t(){return this.innerHTML},set:function t(e){var i=this;var n=e.result,r=e.elemEvents;console.info("Element is in the DOM?: "+this.isConnected);if(this.isConnected&&!isEmptyObject(this.vdom)&&document.contains(this)){var o=HTMLtoJSON(n,this);var a=this.vdom;var c=function t(e,n){var r=function t(e,n,r){var o=Object.is(_typeof(e),"undefined"),a=Object.is(_typeof(n),"undefined");if(o&&a){console.log("nothing to change");return}var i=Object.assign({},e),c=Object.assign({},n);var l={newContent:"",oldContent:"",children:[],index:r};if(!o&&a){l.oldContent=i.textValue;l.newContent="";l.index=r}else if(o&&!a){l.oldContent="";l.newContent=c.textValue;l.tagName=c.tagName;l.index=r+1}else{var s=i.textValue;var u=c.textValue;if(s!==u){l.newContent=u;l.oldContent=s}else{l.textContent=c.textContent}}var f=i.children||[];var d=c.children||[];var h=Math.max(f.length,d.length);if(h>0&&i.textContent!==c.textContent){for(var v=0;v<h;v++){var y=t(f[v],d[v],v);if(y.newContent||y.oldContent||i.textContent!==c.textContent&&y.children.length>0){l.children.push(y)}}}return l};var o=r(e,n,-1);var a=function t(e,n){var r=Object.is(_typeof(e),"undefined"),o=Object.is(_typeof(n),"undefined");if(r&&o){console.log("no diffs to apply");return}var a=e.children;if(a.length&&e.textContent!==n.textContent){var i=true;var c=false;var l=undefined;try{for(var s=a[Symbol.iterator](),u;!(i=(u=s.next()).done);i=true){var f=u.value;var d=n.children;var h=f.index<d.length?d[f.index]:n;t(f,h)}}catch(t){c=true;l=t}finally{try{if(!i&&s.return!=null){s.return()}}finally{if(c){throw l}}}}if(e.newContent){if(e.oldContent){n.firstChild.nodeValue=e.newContent;console.log("content updating")}else{var v=document.createElement(e.tagName);var y=document.createTextNode(e.newContent);v.appendChild(y);n.appendChild(v)}}else if(e.oldContent){n.remove()}};a(o,i)};c(a,o);this.vdom=o}else{this.innerHTML=n;this.vdom=HTMLtoJSON(n,this);console.log(this.vdom);var l=true;var s=false;var u=undefined;try{for(var f=r[Symbol.iterator](),d;!(l=(d=f.next()).done);l=true){var h=d.value;var v=h.constrictID,y=h.constrictIDValue,m=h.eventHandler,p=h.eventType,b=h.handlerBody;var g=this.querySelector("[".concat(v,'="').concat(y,'"]'));if(g!=null&&typeof m==="function"){if(!m.name&&b.startsWith("function")){debugger;console.error(b,"function expression must have a name");throw new TypeError("function expression must have a name")}g[p]&&g.addEventListener(p,m);g.removeAttribute(v)}}}catch(t){s=true;u=t}finally{try{if(!l&&f.return!=null){f.return()}}finally{if(s){throw u}}}}},enumerable:true,configurable:true}),_defineProperty(t,"vdom",{value:{},writable:true}),t))}())})();var _default=Constrict;exports.default=_default;